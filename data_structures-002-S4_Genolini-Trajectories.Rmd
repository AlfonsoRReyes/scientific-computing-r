---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE, error=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=TRUE, comment=NA, error=TRUE, warning=FALSE, message = FALSE,
fig.align = 'center')
```


## Basis of object programming

```{r}
setClass(Class="Trajectories",
 representation=representation(
 times = "numeric",
 traj = "matrix"
 ) )

```

## 4.2 Default constructor

```{r}
new(Class="Trajectories")
```

As you can note, the result is not easy to read... It will be important to define a
method to improve it. We’ll deal with that in the section 5.2 page 20.
It is possible to define an object by specifying the values of its slots (all of them, or
partly). We must each time specify it name of the concerning field:

```{r}
new(Class="Trajectories",times=c(1,3,4))
```


```{r}
new(Class="Trajectories",times=c(1,3),traj=matrix(1:4,ncol=2))
```

An object can be stored in a variable like any other value of R. To illustrate our
statements, we are going to build up a small example. Three hospitals take part to the
study. The Piti´e Salpˆetriere (which has not yet returned its data file, shame on them!), Cochin and Saint-Anne:

```{r}
trajPitie <- new(Class="Trajectories")
trajCochin <- new(Class= "Trajectories",
                 times=c(1,3,4,5),
                 traj=rbind (
                 c(15,15.1, 15.2, 15.2),
                 c(16,15.9, 16,16.4),
                 c(15.2, NA, 15.3, 15.3),
                 c(15.7, 15.6, 15.8, 16)
 ))

```


```{r}
trajStAnne <- new(Class= "Trajectories",
             times=c(1: 10, (6: 16) *2),
             traj=rbind(
                matrix (seq (16,19, length=21), ncol=21, nrow=50, byrow=TRUE),
                matrix (seq (15.8, 18, length=21), ncol=21, nrow=30, byrow=TRUE)
             )+rnorm (21*80,0,0.2)
 )

```


## Reach a slot

```{r}
trajCochin@times
```

```{r}
trajCochin@times <- c(1,2,4,5)
trajCochin
```

As we will see thereafter, the use of the @ should be avoided. Indeed, it does not
call upon the methods of checking. The use that we present here (posting of a field, and
even worse, assignment of a value to a field) should thus be proscribed in most cases.

It is also possible to use the functions attr or attributes, but it is even
worse: if one makes a simple typographic error, one modifies the structure of
the object. And that is very very very bad!

## 4.4 Default values
```{r}
setClass(Class = "TrajectoriesBis", 
         representation=representation(
             time = "numeric",
             traj = "matrix"
         ),
         prototype=prototype(
            time = 1,
            traj = matrix (0)
 ) )
```



## The empty object

```{r}
identical(numeric(),integer())
```


## 4.7 to see an object

```{r}
slotNames("Trajectories")
```

```{r}
getSlots ("Trajectories")
```

```{r}
getClass ("Trajectories")
```


## SetMethod

```{r}
setMethod("plot",
     signature = "Trajectories", function (x, y,...) {
        matplot(x@times,t(x@traj),xaxt="n",type="l",ylab= "", xlab="", pch=1)
        axis(1,at=x@times)
})
```

```{r}
plot(trajCochin)
```


```{r}
setMethod ("print","Trajectories", function(x,...) {
    cat("*** Class Trajectories, method Print *** \n")
    cat("* Times ="); print (x@times)
    cat("* Traj = \n"); print (x@traj)
    cat("******* End Print (trajectories) ******* \n")
})

```

```{r}
print(trajCochin)
```

```{r}
print(trajStAnne)
```

For Cochin, the result is correct. For Saint-Anne, print will display too much
information. So we need a second method.

`show` is the default method used to show an object when its name is write in the
console. We thus define it by taking into account the size of the object: if there are too many trajectories, show post only part of them.


```{r}
setMethod("show","Trajectories", function(object) {
    cat("*** Class Trajectories, method Show *** \n")
    cat("* Times ="); print(object@times)
    nrowShow <- min(10, nrow(object@traj))
    ncolShow <- min(10, ncol(object@traj))
    cat("* Traj (limited to a matrix 10x10) = \n")
    print(formatC(object@traj[1:nrowShow,1:ncolShow]),quote=FALSE)
    cat("******* End Show (trajectories) ******* \n")
 })
```

```{r}
trajStAnne
```


A small problem must still be regulated. We saw in section 4.6 page 17 that `new`
should be usable without any argument. However, it is no longer true:


```{r}
new("Trajectories")
```

## Taking in account an empty object

Indeed, `new` creates an object, then display it using `show`. In the case of new without
any argument, the empty object is send to show. However, show as we conceived it
cannot treat the empty object.

More generally, all our methods must take into account the fact that they may have
to deal with the empty object:

```{r}
setMethod("show","Trajectories", function(object){
     cat("*** Class Trajectories, method Show *** \n")
     cat("* Times = "); print (object@times)
     
     nrowShow <- min(10,nrow(object@traj))
     ncolShow <- min(10,ncol(object@traj))
     cat("* Traj (limited to a matrix 10x10) = \n")
     
     if(length(object@traj) != 0){
        print(formatC(object@traj[1:nrowShow,1:ncolShow]),quote=FALSE)
     } else {}
        cat("******* End Show (trajectories) ******* \n")
 }
 )
```

```{r}
new("Trajectories")
```


